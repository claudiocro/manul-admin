{"version":3,"sources":["../src/actions.js"],"names":[],"mappings":"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","file":"actions.js","sourcesContent":["import Papa from 'papaparse';\nimport _ from 'lodash';\nimport flat from 'flat';\n\nimport FallbackAlerts from './fallback_alerts';\nimport csv from './utils/csv';\nimport routeUtils from './utils/route_utils';\nimport { stateListFilter, stateListSort, statePageProperties } from './utils/local_state_utils';\n\n\nexport default {\n  manulAdmin: {\n    gotoCreate({ adminContext: { gotoRoute } }, collectionName) {\n      gotoRoute(routeUtils.getCreateRoute(collectionName).name);\n    },\n    gotoEdit({ adminContext: { gotoRoute } }, collectionName, _id) {\n      gotoRoute(routeUtils.getEditRoute(collectionName).name, { _id });\n    },\n    gotoList({ adminContext: { gotoRoute } }, collectionName) {\n      gotoRoute(routeUtils.getListRoute(collectionName).name);\n    },\n    // sortProperty is according to react-griddle\n    listSortToggle({ LocalState }, collectionName, newSortProperty) {\n      const localStateSortProperties = stateListSort(collectionName);\n      const sortProperties = LocalState.get(localStateSortProperties) || [];\n      const oldProperty = _.find(sortProperties, s => s.id === newSortProperty.id);\n      let newSortProps = [];\n\n      if (!oldProperty) {\n        newSortProps = [{ ...newSortProperty, sortAscending: true }, ...sortProperties];\n      } else {\n        newSortProps = _.without(sortProperties, oldProperty);\n        if (oldProperty.sortAscending) {\n          newSortProps = [{ ...newSortProperty, sortAscending: false }, ...newSortProps];\n        }\n      }\n      LocalState.set(localStateSortProperties, newSortProps);\n    },\n    listSetSort({ LocalState }, collectionName, sortProperties) {\n      LocalState.set(stateListSort(collectionName), sortProperties);\n    },\n    listSetFilter({ LocalState }, collectionName, filter) {\n      LocalState.set(stateListFilter(collectionName), filter);\n    },\n    listSetPageProperties({ LocalState }, collectionName, pageProperties) {\n      LocalState.set(statePageProperties(collectionName), pageProperties);\n    },\n    listGotoPage({ LocalState }, collectionName, currentPage) {\n      const pageProperties = LocalState.get(statePageProperties(collectionName));\n      LocalState.set(statePageProperties(collectionName), { ...pageProperties, currentPage });\n    },\n    listGotoNextPage({ LocalState }, collectionName) {\n      const pageProperties = LocalState.get(statePageProperties(collectionName));\n      LocalState.set(statePageProperties(\n        collectionName),\n        { ...pageProperties, currentPage: pageProperties.currentPage + 1 },\n      );\n    },\n    listGotoPreviousPage({ LocalState }, collectionName) {\n      const pageProperties = LocalState.get(statePageProperties(collectionName));\n      LocalState.set(statePageProperties(\n        collectionName), { ...pageProperties, currentPage: pageProperties.currentPage - 1 },\n      );\n    },\n    update(\n      { adminContext: { methods, gotoRoute }, Alerts = FallbackAlerts },\n      collectionName, doc,\n    ) {\n      methods[collectionName].update.call(doc,\n        Alerts.handleCallback('admin.update', { props: () => ({ collectionName, doc }) }, (error) => {\n          if (!error) {\n            gotoRoute(routeUtils.getListRoute(collectionName).name);\n          }\n        }),\n    );\n    },\n    create(\n      { adminContext: { methods, gotoRoute }, Alerts = FallbackAlerts },\n      collectionName, doc,\n    ) {\n      methods[collectionName].create.call(doc,\n        Alerts.handleCallback('admin.create', { props: () => ({ collectionName, doc }) }, (error, _id) => {\n          if (!error) {\n            gotoRoute(routeUtils.getEditRoute(collectionName).name, { _id });\n          }\n        }),\n    );\n    },\n    destroy(\n      { adminContext: { methods, gotoRoute }, Alerts = FallbackAlerts },\n      collectionName, _id,\n    ) {\n      /* eslint no-alert: 0*/\n      const confirmed = window.confirm(\"Really destroy? This can't be undone\");\n      if (confirmed) {\n        methods[collectionName].destroy.call({ _id },\n          Alerts.handleCallback('admin.destroy', { props: () => ({ collectionName, _id }) }, (error) => {\n            if (!error) {\n              gotoRoute(routeUtils.getListRoute(collectionName).name);\n            }\n          }),\n      );\n      }\n    },\n    downloadCsv(\n      { adminContext: { methods }, Alerts = FallbackAlerts },\n      collectionName, options,\n    ) {\n      methods[collectionName].export.call({},\n        Alerts.handleCallback('admin.export', { props: () => ({ collectionName }) }, (error, { data, keys }) => {\n          if (!error) {\n            csv.exportAsCsv({ filename: `export_${collectionName}`, data, keys, ...options });\n          }\n        }),\n      );\n    },\n    importCsv(\n      { adminContext: { methods } },\n      { collectionName, file, onInsert = _.noop, onUpdate = _.noop, onComplete = _.noop },\n    ) {\n      let counter = -1;\n      const imported = new Set();\n      Papa.parse(file, {\n        header: true,\n        dynamicTyping: true,\n        complete({ data }) {\n          data.forEach((entryUncleaned) => {\n            counter += 1;\n            const index = counter; // need constant closure copy\n            const checkForComplete = () => {\n              imported.add(index);\n              if (imported.size === data.length) {\n                onComplete();\n              }\n            };\n            // console.log('uncleaned', entryUncleaned);\n            const entry = flat.unflatten(\n              _.omitBy(entryUncleaned, value => value === 'NULL'),\n            );\n            // console.log('cleaned', entry);\n            if (entry._id) {\n              methods[collectionName].update.call(entry, (error) => {\n                onUpdate(index, error, entry);\n                checkForComplete();\n              });\n            } else {\n              delete entry._id; // if falsy\n              methods[collectionName].create.call(entry, (error, _id) => {\n                onInsert(index, error, { _id, ...entry });\n                checkForComplete();\n              });\n            }\n          });\n        },\n      });\n    },\n  },\n};\n"]}