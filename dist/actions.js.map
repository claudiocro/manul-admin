{"version":3,"sources":["../src/actions.js"],"names":[],"mappings":"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","file":"actions.js","sourcesContent":["import Papa from 'papaparse';\nimport _ from 'lodash';\nimport flat from 'flat';\n\nimport FallbackAlerts from './fallback_alerts';\nimport csv from './utils/csv';\nimport routeUtils from './utils/route_utils';\n\nexport default {\n  manulAdmin: {\n    gotoCreate({ adminContext: { gotoRoute } }, collectionName) {\n      gotoRoute(routeUtils.getCreateRoute(collectionName).name);\n    },\n    gotoEdit({ adminContext: { gotoRoute } }, collectionName, _id) {\n      gotoRoute(routeUtils.getEditRoute(collectionName).name, { _id });\n    },\n    gotoList({ adminContext: { gotoRoute } }, collectionName) {\n      gotoRoute(routeUtils.getListRoute(collectionName).name);\n    },\n    update(\n      { adminContext: { methods, gotoRoute }, Alerts = FallbackAlerts },\n      collectionName, doc,\n    ) {\n      methods[collectionName].update.call(doc,\n        Alerts.handleCallback('admin.update', { props: () => ({ collectionName, doc }) }, (error) => {\n          if (!error) {\n            gotoRoute(routeUtils.getListRoute(collectionName).name);\n          }\n        }),\n    );\n    },\n    create(\n      { adminContext: { methods, gotoRoute }, Alerts = FallbackAlerts },\n      collectionName, doc,\n    ) {\n      methods[collectionName].create.call(doc,\n        Alerts.handleCallback('admin.create', { props: () => ({ collectionName, doc }) }, (error, _id) => {\n          if (!error) {\n            gotoRoute(routeUtils.getEditRoute(collectionName).name, { _id });\n          }\n        }),\n    );\n    },\n    destroy(\n      { adminContext: { methods, gotoRoute }, Alerts = FallbackAlerts },\n      collectionName, _id,\n    ) {\n      /* eslint no-alert: 0*/\n      const confirmed = window.confirm(\"Really destroy? This can't be undone\");\n      if (confirmed) {\n        methods[collectionName].destroy.call({ _id },\n          Alerts.handleCallback('admin.destroy', { props: () => ({ collectionName, _id }) }, (error) => {\n            if (!error) {\n              gotoRoute(routeUtils.getListRoute(collectionName).name);\n            }\n          }),\n      );\n      }\n    },\n    downloadCsv(\n      { adminContext: { methods }, Alerts = FallbackAlerts },\n      collectionName, options,\n    ) {\n      methods[collectionName].export.call({},\n        Alerts.handleCallback('admin.export', { props: () => ({ collectionName }) }, (error, { data, keys }) => {\n          if (!error) {\n            csv.exportAsCsv({ filename: `export_${collectionName}`, data, keys, ...options });\n          }\n        }),\n      );\n    },\n    importCsv(\n      { adminContext: { methods } },\n      { collectionName, file, onInsert = _.noop, onUpdate = _.noop, onComplete = _.noop },\n    ) {\n      let counter = -1;\n      const imported = new Set();\n      Papa.parse(file, {\n        header: true,\n        dynamicTyping: true,\n        complete({ data }) {\n          data.forEach((entryUncleaned) => {\n            counter += 1;\n            const index = counter; // need constant closure copy\n            const checkForComplete = () => {\n              imported.add(index);\n              if (imported.size === data.length) {\n                onComplete();\n              }\n            };\n            // console.log('uncleaned', entryUncleaned);\n            const entry = flat.unflatten(\n              _.omitBy(entryUncleaned, value => value === 'NULL'),\n            );\n            // console.log('cleaned', entry);\n            if (entry._id) {\n              methods[collectionName].update.call(entry, (error) => {\n                onUpdate(index, error, entry);\n                checkForComplete();\n              });\n            } else {\n              delete entry._id; // if falsy\n              methods[collectionName].create.call(entry, (error, _id) => {\n                onInsert(index, error, { _id, ...entry });\n                checkForComplete();\n              });\n            }\n          });\n        },\n      });\n    },\n  },\n};\n"]}