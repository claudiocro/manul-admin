{"version":3,"sources":["../src/init_admin_server.js"],"names":[],"mappings":";;;;;;;;;;sCAC6B,2BAA2B;;;;8BAC9B,kBAAkB;;;;0BACtB,cAAc;;;;qBAErB,UAAC,IAAiD,EAAE,MAAM,EAAK;MAA5D,MAAM,GAAR,IAAiD,CAA/C,MAAM;MAAE,eAAe,GAAzB,IAAiD,CAAvC,eAAe;MAAE,YAAY,GAAvC,IAAiD,CAAtB,YAAY;MAAE,MAAM,GAA/C,IAAiD,CAAR,MAAM;;AAC7D,MAAM,SAAS,GAAG,6BAAU,MAAM,CAAC,CAAC;MAC5B,WAAW,GAAK,MAAM,CAAtB,WAAW;;AAEnB,MAAM,iBAAiB,GAAG,SAApB,iBAAiB,CAAI,IAAI,EAAK;4CACH,oCAAiB,eAAe,CAAC,IAAI,CAAC;;QAA7D,IAAI,qCAAJ,IAAI;QAAE,IAAI,qCAAJ,IAAI;QAAE,MAAM,qCAAN,MAAM;QAClB,UAAU,GAAK,WAAW,CAAC,IAAI,CAAC,CAAhC,UAAU;;;AAGlB,UAAM,CAAC,OAAO,CAAC,IAAI,EAAE,SAAS,WAAW,CAAC,KAAK,EAAE,OAAO,EAAE;AACxD,UAAI,SAAS,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,EAAE;;AAEhC,cAAM,CAAC,OAAO,CAAC,IAAI,EAAE,MAAM,EAAE,UAAU,CAAC,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC,CAAC;AAC9D,eAAO,UAAU,CAAC,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;OACxC;KACF,CAAC,CAAC;AACH,UAAM,CAAC,OAAO,CAAC,IAAI,EAAE,SAAS,WAAW,CAAC,GAAG,EAAE;AAC7C,UAAI,SAAS,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,EAAE;AAChC,eAAO,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;OAC7B;KACF,CAAC,CAAC;GACJ,CAAC;AACF,MAAM,kBAAkB,GAAG,SAArB,kBAAkB,GAAS;AAC/B,iBAAY,WAAW,CAAC,CAAC,OAAO,CAAC,iBAAiB,CAAC,CAAC;GACrD,CAAC;AACF,oBAAkB,EAAE,CAAC;AACrB,mCAAc,EAAE,MAAM,EAAN,MAAM,EAAE,eAAe,EAAf,eAAe,EAAE,YAAY,EAAZ,YAAY,EAAE,EAAE,MAAM,CAAC,CAAC;CAClE","file":"init_admin_server.js","sourcesContent":["\nimport publicationUtils from './utils/publication_utils';\nimport createMethods from './create_methods';\nimport IsAllowed from './is_allowed';\n\nexport default ({ Meteor, ValidatedMethod, SimpleSchema, Counts }, config) => {\n  const isAllowed = IsAllowed(config);\n  const { collections } = config;\n\n  const createPublication = (name) => {\n    const { list, edit, counts } = publicationUtils.getPublications(name);\n    const { collection } = collections[name];\n\n    /* eslint meteor/audit-argument-checks: 0*/\n    Meteor.publish(list, function publishList(query, options) {\n      if (isAllowed(name, this.userId)) {\n        // can't reuse \"users\" cursor\n        Counts.publish(this, counts, collection.find(query, options));\n        return collection.find(query, options);\n      }\n    });\n    Meteor.publish(edit, function publishEdit(_id) {\n      if (isAllowed(name, this.userId)) {\n        return collection.find(_id);\n      }\n    });\n  };\n  const createPublications = () => {\n    Object.keys(collections).forEach(createPublication);\n  };\n  createPublications();\n  createMethods({ Meteor, ValidatedMethod, SimpleSchema }, config);\n};\n"]}